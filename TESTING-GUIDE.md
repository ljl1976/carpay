# 🧪 测试指南

## 快速测试新界面

---

## 🚀 启动本地开发服务器

```bash
# 1. 安装依赖(如果还没安装)
npm install

# 2. 启动开发服务器
npm run dev

# 3. 打开浏览器
# 访问 http://localhost:3000
```

---

## ✅ 测试清单

### 1. 上传功能测试

#### 测试步骤:
1. 打开应用,默认在"用车订单审计"页面
2. 点击上传区域(虚线框)
3. 选择一个 Excel 文件(.xlsx 或 .xls)
4. 观察界面变化

#### 预期结果:
- ✅ 文件名显示在上传区域
- ✅ 显示绿色对勾图标
- ✅ 底部显示成功提示:"✓ 成功上传 X 条数据"
- ✅ "规则审计"按钮变为可点击状态
- ✅ 提示文字变为"文件已上传,可以执行规则审计"

---

### 2. 规则审计功能测试

#### 测试步骤:
1. 上传文件后,点击"规则审计"按钮
2. 观察界面变化

#### 预期结果:
- ✅ 按钮显示"审计中..."
- ✅ 所有按钮禁用
- ✅ 底部显示"正在执行规则审计..."
- ✅ 审计完成后:
  - 统计卡片显示数据(总订单、合规、不合规、合规率)
  - 结果表格显示审计数据
  - 不合规订单高亮显示(红色背景)
  - 底部显示"✓ 规则审计完成"
  - "AI一键分析"按钮变为可点击
  - 提示文字变为"数据已就绪,可以执行AI分析"

---

### 3. AI一键分析功能测试

#### 测试步骤:
1. 规则审计完成后,点击"AI一键分析"按钮
2. 观察界面变化

#### 预期结果:
- ✅ 按钮显示"AI分析中..."
- ✅ 所有按钮禁用
- ✅ 底部显示"正在进行AI分析..."
- ✅ 分析完成后:
  - 自动跳转到"风险报告"页面
  - 左侧菜单"风险报告"高亮
  - 显示完整的风险报告内容
  - 底部显示"✓ AI分析完成,请查看风险报告"

---

### 4. 风险报告页面测试

#### 测试步骤 A: 有数据时
1. 执行AI分析后,查看风险报告页面
2. 检查报告内容

#### 预期结果:
- ✅ 显示"风险报告"标题
- ✅ 显示报告内容:
  - 总体概况
  - 风险分类统计
  - 高风险人员列表
  - 建议措施

#### 测试步骤 B: 无数据时
1. 直接点击左侧菜单"风险报告"
2. 观察空状态显示

#### 预期结果:
- ✅ 显示空状态图标(图表图标)
- ✅ 显示"暂无风险报告"提示
- ✅ 显示说明文字
- ✅ 显示"前往审计页面"按钮
- ✅ 点击按钮跳转到"用车订单审计"页面

---

### 5. 下载功能测试

#### 测试步骤:
1. 规则审计完成后,在结果表格区域
2. 点击"下载审计结果"按钮

#### 预期结果:
- ✅ 浏览器下载 Excel 文件
- ✅ 文件名格式:"用车订单审计结果_YYYY/M/D.xlsx"
- ✅ 打开文件,包含"审计结果" sheet
- ✅ 数据包含所有列,包括"审计结果"列

---

### 6. 查看风险报告按钮测试

#### 测试步骤 A: 已有报告数据
1. 执行AI分析后,返回"用车订单审计"页面
2. 在结果表格区域点击"查看风险报告"按钮

#### 预期结果:
- ✅ 跳转到"风险报告"页面
- ✅ 显示之前生成的报告数据

#### 测试步骤 B: 无报告数据
1. 只执行规则审计,不执行AI分析
2. 点击"查看风险报告"按钮

#### 预期结果:
- ✅ 弹出提示:"请先执行AI一键分析"
- ✅ 不跳转页面

---

### 7. 菜单切换测试

#### 测试步骤:
1. 依次点击左侧菜单的三个选项:
   - 用车订单审计
   - 风险报告
   - 审计规则设置

#### 预期结果:
- ✅ 点击后对应菜单项高亮(蓝色背景)
- ✅ 右侧内容区域切换到对应页面
- ✅ 页面切换流畅,无闪烁
- ✅ 数据保持不变(切换回来后数据还在)

---

### 8. 按钮状态测试

#### 测试场景 A: 初始状态
- ✅ "规则审计"按钮:禁用(灰色)
- ✅ "AI一键分析"按钮:禁用(灰色)
- ✅ 提示:"请先上传文件"

#### 测试场景 B: 文件已上传
- ✅ "规则审计"按钮:可点击(绿色)
- ✅ "AI一键分析"按钮:禁用(灰色)
- ✅ 提示:"文件已上传,可以执行规则审计"

#### 测试场景 C: 规则审计完成
- ✅ "规则审计"按钮:可点击(绿色)
- ✅ "AI一键分析"按钮:可点击(紫色)
- ✅ 提示:"数据已就绪,可以执行AI分析"

#### 测试场景 D: 审计进行中
- ✅ "规则审计"按钮:禁用,显示"审计中..."
- ✅ "AI一键分析"按钮:禁用
- ✅ 上传区域:禁用

#### 测试场景 E: AI分析进行中
- ✅ "规则审计"按钮:禁用
- ✅ "AI一键分析"按钮:禁用,显示"AI分析中..."
- ✅ 上传区域:禁用

---

### 9. 结果表格测试

#### 测试步骤:
1. 执行规则审计后,查看结果表格
2. 点击表头进行排序
3. 检查不合规订单高亮

#### 预期结果:
- ✅ 表格显示所有审计数据
- ✅ 不合规订单行背景为红色
- ✅ 点击表头可以排序(升序/降序)
- ✅ 审计结果列:
  - 合规订单显示"合规"(绿色)
  - 不合规订单显示具体原因(红色)

---

### 10. 统计卡片测试

#### 测试步骤:
1. 执行规则审计后,查看顶部统计卡片

#### 预期结果:
- ✅ 显示4个卡片:
  - 总订单数
  - 合规订单数(绿色)
  - 不合规订单数(红色)
  - 合规率(百分比)
- ✅ 数据与表格数据一致
- ✅ 合规率计算正确

---

## 🐛 常见问题排查

### 问题 1: 上传文件后没有反应

**可能原因:**
- Excel 文件没有"用车订单" sheet
- 文件格式不正确

**解决方法:**
1. 检查 Excel 文件是否包含名为"用车订单"的 sheet
2. 确保文件是 .xlsx 或 .xls 格式
3. 打开浏览器控制台查看错误信息

---

### 问题 2: 规则审计失败

**可能原因:**
- API 端点 `/api/audit` 不可用
- Excel 数据格式不正确

**解决方法:**
1. 检查浏览器控制台的网络请求
2. 确认 API 返回的错误信息
3. 检查 Excel 文件是否包含必需的列

---

### 问题 3: AI分析失败

**可能原因:**
- 环境变量未配置
- AI Gateway 不可用
- 网络问题

**解决方法:**
1. 检查 `.env.local` 文件是否配置了:
   - `AI_GATEWAY_URL`
   - `AI_GATEWAY_KEY`
   - `OE_KEY`
   - `OE_GATEWAY_NAME`
   - `OE_AI_PROVIDER`
2. 检查浏览器控制台的网络请求
3. 确认 AI Gateway 服务正常

---

### 问题 4: 按钮一直禁用

**可能原因:**
- 状态管理错误
- 上传失败但状态未重置

**解决方法:**
1. 刷新页面重试
2. 检查浏览器控制台是否有错误
3. 重新上传文件

---

## 📊 测试数据准备

### Excel 文件要求:

#### Sheet 名称:
- 必须包含名为"用车订单"的 sheet

#### 必需的列:
- 下单人姓名
- 开始计费时间
- 实际出发地
- 实际目的地
- 企业实付金额
- 补充说明
- 用车类型(明细)

#### 示例数据:

| 下单人姓名 | 开始计费时间 | 实际出发地 | 实际目的地 | 企业实付金额 | 补充说明 | 用车类型(明细) |
|-----------|-------------|-----------|-----------|-------------|---------|---------------|
| 张三 | 2024-01-15 08:30 | 家 | 公司 | 25.5 | 上班打车 | 快车 |
| 李四 | 2024-01-15 18:00 | 公司 | KTV | 45.0 | 加班后放松 | 专车 |
| 王五 | 2024-01-16 14:00 | 公司 | 客户公司 | 35.0 | 接客户 | 快车 |

---

## ✅ 完整测试流程

### 推荐测试顺序:

```
1. 启动开发服务器
   ↓
2. 测试上传功能
   ↓
3. 测试规则审计
   ↓
4. 测试结果表格和统计
   ↓
5. 测试下载功能
   ↓
6. 测试AI一键分析
   ↓
7. 测试风险报告页面
   ↓
8. 测试菜单切换
   ↓
9. 测试按钮状态
   ↓
10. 测试空状态和错误处理
```

---

## 🎯 测试通过标准

### 所有测试项目都应该:
- ✅ 功能正常工作
- ✅ 界面显示正确
- ✅ 无控制台错误
- ✅ 用户体验流畅
- ✅ 状态管理正确

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: 
**浏览器**: Chrome/Edge/Firefox
**版本**: 

### 测试结果:

- [ ] 上传功能
- [ ] 规则审计
- [ ] AI一键分析
- [ ] 风险报告
- [ ] 下载功能
- [ ] 菜单切换
- [ ] 按钮状态
- [ ] 结果表格
- [ ] 统计卡片
- [ ] 错误处理

### 发现的问题:

1. 
2. 
3. 

### 建议:

1. 
2. 
3. 
```

---

**开始测试吧! 🚀**

如有问题,请查看浏览器控制台的错误信息。

