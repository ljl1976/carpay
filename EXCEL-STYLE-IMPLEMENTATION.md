# ğŸ“Š Excel æ ·å¼å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å®‰è£… xlsx-js-style åº“

```bash
npm install xlsx-js-style
```

**ä¸ºä»€ä¹ˆéœ€è¦ xlsx-js-style?**
- åŸºç¡€çš„ `xlsx` åº“ä¸æ”¯æŒæ ·å¼(é¢œè‰²ã€å­—ä½“ã€è¾¹æ¡†ç­‰)
- `xlsx-js-style` æ˜¯ `xlsx` çš„å¢å¼ºç‰ˆ,æ”¯æŒå®Œæ•´çš„æ ·å¼åŠŸèƒ½

---

### 2. å®ç°çš„æ ·å¼åŠŸèƒ½

#### âœ… è¡¨å¤´è¡Œæ ·å¼
- **å­—ä½“**: å¾®è½¯é›…é»‘ 10å· åŠ ç²—
- **èƒŒæ™¯è‰²**: æ·¡è“ (#DDEBF7)
- **å¯¹é½**: å±…ä¸­
- **è¾¹æ¡†**: ç»†è¾¹æ¡†

#### âœ… é‡‘é¢åˆ—æ ·å¼
- **å¯¹é½**: å³å¯¹é½
- **æ ¼å¼**: Â¥#,##0.00 (è´§å¸æ ¼å¼)
- **ç¤ºä¾‹**: Â¥1,250.50

#### âœ… æ—¶é—´åˆ—æ ·å¼
- **æ ¼å¼**: yyyy-mm-dd hh:mm
- **ç¤ºä¾‹**: 2024-01-15 08:30

#### âœ… å®¡è®¡ç»“æœåˆ—æ ·å¼
- **åˆè§„**: ç»¿è‰² (#00B050)
- **ç–‘ä¼¼**: æ©™è‰² (#FFC000)
- **è¿è§„**: çº¢è‰² (#FF0000)

#### âœ… è¾¹æ¡†
- **æ‰€æœ‰å•å…ƒæ ¼**: ç»†è¾¹æ¡† (thin)

#### âœ… å­—ä½“
- **æ‰€æœ‰å•å…ƒæ ¼**: å¾®è½¯é›…é»‘ 10å·

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. package.json

**æ–°å¢ä¾èµ–:**
```json
{
  "dependencies": {
    "xlsx-js-style": "^1.2.0"
  }
}
```

---

### 2. app/page.tsx

**å¯¼å…¥ xlsx-js-style:**
```typescript
import * as XLSXStyle from 'xlsx-js-style'
```

**ä¿®æ”¹ä¸‹è½½å‡½æ•°:**
```typescript
const handleDownload = () => {
  const workbook = XLSXStyle.utils.book_new()
  
  // Sheet 1: å®¡è®¡ç»“æœæ˜ç»†
  const detailSheet = XLSXStyle.utils.json_to_sheet(auditedData)
  applyDetailSheetStyles(detailSheet, auditedData.length)
  XLSXStyle.utils.book_append_sheet(workbook, detailSheet, 'å®¡è®¡ç»“æœæ˜ç»†')
  
  // Sheet 2: éƒ¨é—¨æ±‡æ€»
  const summaryData = generateDepartmentSummary(auditedData)
  const summarySheet = XLSXStyle.utils.json_to_sheet(summaryData)
  applySummarySheetStyles(summarySheet, summaryData.length)
  XLSXStyle.utils.book_append_sheet(workbook, summarySheet, 'éƒ¨é—¨æ±‡æ€»')
  
  // ä¸‹è½½
  XLSXStyle.writeFile(workbook, fileName)
}
```

**æ–°å¢æ ·å¼å‡½æ•°:**
- `applyDetailSheetStyles()` - å®¡è®¡ç»“æœæ˜ç»†æ ·å¼
- `applySummarySheetStyles()` - éƒ¨é—¨æ±‡æ€»æ ·å¼

---

## ğŸ¨ æ ·å¼è¯¦ç»†è¯´æ˜

### Sheet 1: å®¡è®¡ç»“æœæ˜ç»†

#### è¡¨å¤´è¡Œ (ç¬¬1è¡Œ)
```typescript
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10, bold: true },
  fill: { fgColor: { rgb: 'DDEBF7' } },
  alignment: { horizontal: 'center', vertical: 'center' },
  border: {
    top: { style: 'thin', color: { rgb: '000000' } },
    bottom: { style: 'thin', color: { rgb: '000000' } },
    left: { style: 'thin', color: { rgb: '000000' } },
    right: { style: 'thin', color: { rgb: '000000' } }
  }
}
```

#### é‡‘é¢åˆ— (ä¼ä¸šå®ä»˜é‡‘é¢)
```typescript
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10 },
  alignment: { horizontal: 'right', vertical: 'center' },
  numFmt: 'Â¥#,##0.00',
  border: { ... }
}
```

#### æ—¶é—´åˆ— (å¼€å§‹è®¡è´¹æ—¶é—´)
```typescript
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10 },
  alignment: { vertical: 'center' },
  numFmt: 'yyyy-mm-dd hh:mm',
  border: { ... }
}
```

#### å®¡è®¡ç»“æœåˆ—
```typescript
// åˆè§„ (ç©ºæˆ–"åˆè§„")
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10, color: { rgb: '00B050' } },
  alignment: { vertical: 'center' },
  border: { ... }
}

// ç–‘ä¼¼ (åŒ…å«"ç–‘ä¼¼")
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10, color: { rgb: 'FFC000' } },
  alignment: { vertical: 'center' },
  border: { ... }
}

// è¿è§„ (å…¶ä»–)
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10, color: { rgb: 'FF0000' } },
  alignment: { vertical: 'center' },
  border: { ... }
}
```

---

### Sheet 2: éƒ¨é—¨æ±‡æ€»

#### è¡¨å¤´è¡Œ
- ä¸å®¡è®¡ç»“æœæ˜ç»†ç›¸åŒ

#### é‡‘é¢æ±‡æ€»åˆ— (ä¼ä¸šå®ä»˜é‡‘é¢æ±‡æ€»)
```typescript
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10 },
  alignment: { horizontal: 'right', vertical: 'center' },
  numFmt: 'Â¥#,##0.00',
  border: { ... }
}
```

#### å…¶ä»–åˆ—
```typescript
{
  font: { name: 'å¾®è½¯é›…é»‘', sz: 10 },
  alignment: { vertical: 'center' },
  border: { ... }
}
```

---

## ğŸ”§ æ ·å¼åº”ç”¨é€»è¾‘

### 1. è¡¨å¤´æ ·å¼åº”ç”¨

```typescript
// éå†ç¬¬ä¸€è¡Œçš„æ‰€æœ‰åˆ—
for (let C = range.s.c; C <= range.e.c; ++C) {
  const headerCell = XLSXStyle.utils.encode_cell({ r: 0, c: C })
  
  sheet[headerCell].s = {
    font: { name: 'å¾®è½¯é›…é»‘', sz: 10, bold: true },
    fill: { fgColor: { rgb: 'DDEBF7' } },
    alignment: { horizontal: 'center', vertical: 'center' },
    border: { ... }
  }
}
```

### 2. æ•°æ®è¡Œæ ·å¼åº”ç”¨

```typescript
// éå†æ‰€æœ‰æ•°æ®è¡Œå’Œåˆ—
for (let R = 1; R <= rowCount; ++R) {
  for (let C = range.s.c; C <= range.e.c; ++C) {
    const cellAddress = XLSXStyle.utils.encode_cell({ r: R, c: C })
    const headerValue = sheet[headerCell]?.v || ''
    
    // æ ¹æ®åˆ—ååº”ç”¨ä¸åŒæ ·å¼
    if (headerValue.includes('é‡‘é¢')) {
      // é‡‘é¢åˆ—æ ·å¼
    } else if (headerValue.includes('æ—¶é—´')) {
      // æ—¶é—´åˆ—æ ·å¼
    } else if (headerValue.includes('å®¡è®¡ç»“æœ')) {
      // å®¡è®¡ç»“æœåˆ—æ ·å¼(æ ¹æ®å€¼è®¾ç½®é¢œè‰²)
    }
    
    sheet[cellAddress].s = cellStyle
  }
}
```

### 3. å®¡è®¡ç»“æœé¢œè‰²åˆ¤æ–­

```typescript
const cellValue = sheet[cellAddress].v || ''

if (!cellValue || cellValue === 'åˆè§„') {
  cellStyle.font.color = { rgb: '00B050' }  // ç»¿è‰²
} else if (cellValue.includes('ç–‘ä¼¼')) {
  cellStyle.font.color = { rgb: 'FFC000' }  // æ©™è‰²
} else {
  cellStyle.font.color = { rgb: 'FF0000' }  // çº¢è‰²
}
```

---

## ğŸ“Š æ ·å¼æ•ˆæœé¢„è§ˆ

### å®¡è®¡ç»“æœæ˜ç»† Sheet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨å¤´è¡Œ (æ·¡è“èƒŒæ™¯ #DDEBF7, åŠ ç²—, å±…ä¸­)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸‹å•äººå§“å â”‚ å¼€å§‹è®¡è´¹æ—¶é—´        â”‚ ä¼ä¸šå®ä»˜é‡‘é¢ â”‚ å®¡è®¡ç»“æœ          â”‚
â”‚            â”‚ (yyyy-mm-dd hh:mm) â”‚ (Â¥#,##0.00) â”‚ (é¢œè‰²æ ‡è¯†)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼ ä¸‰       â”‚ 2024-01-15 08:30   â”‚    Â¥25.50   â”‚ ç–‘ä¼¼ä¸Šç­æ‰“è½¦ (æ©™) â”‚
â”‚ æå››       â”‚ 2024-01-15 18:00   â”‚    Â¥45.00   â”‚ ç¦æ­¢å¨±ä¹åœºæ‰€ (çº¢) â”‚
â”‚ ç‹äº”       â”‚ 2024-01-16 14:00   â”‚    Â¥35.00   â”‚ åˆè§„ (ç»¿)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨é—¨æ±‡æ€» Sheet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨å¤´è¡Œ (æ·¡è“èƒŒæ™¯ #DDEBF7, åŠ ç²—, å±…ä¸­)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è´¦æœŸ    â”‚ éƒ¨é—¨åç§° â”‚ ä¼ä¸šå®ä»˜é‡‘é¢æ±‡æ€»          â”‚
â”‚         â”‚          â”‚ (Â¥#,##0.00, å³å¯¹é½)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2024-01 â”‚ é”€å”®éƒ¨   â”‚              Â¥1,250.50   â”‚
â”‚ 2024-01 â”‚ æŠ€æœ¯éƒ¨   â”‚                Â¥850.00   â”‚
â”‚ 2024-02 â”‚ é”€å”®éƒ¨   â”‚              Â¥1,450.00   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 2. æ‰§è¡Œå®¡è®¡å¹¶ä¸‹è½½

1. ä¸Šä¼  Excel æ–‡ä»¶
2. ç‚¹å‡»"è§„åˆ™å®¡è®¡"
3. ç‚¹å‡»"ä¸‹è½½å®¡è®¡ç»“æœ"
4. æ‰“å¼€ä¸‹è½½çš„ Excel æ–‡ä»¶

### 3. éªŒè¯æ ·å¼

#### å®¡è®¡ç»“æœæ˜ç»† Sheet:
- âœ… è¡¨å¤´è¡Œ: æ·¡è“èƒŒæ™¯ã€åŠ ç²—ã€å±…ä¸­
- âœ… é‡‘é¢åˆ—: å³å¯¹é½ã€è´§å¸æ ¼å¼ (Â¥1,250.50)
- âœ… æ—¶é—´åˆ—: æ—¥æœŸæ—¶é—´æ ¼å¼ (2024-01-15 08:30)
- âœ… å®¡è®¡ç»“æœåˆ—: é¢œè‰²æ ‡è¯†
  - åˆè§„: ç»¿è‰²
  - ç–‘ä¼¼: æ©™è‰²
  - è¿è§„: çº¢è‰²
- âœ… æ‰€æœ‰å•å…ƒæ ¼: ç»†è¾¹æ¡†
- âœ… å­—ä½“: å¾®è½¯é›…é»‘ 10å·

#### éƒ¨é—¨æ±‡æ€» Sheet:
- âœ… è¡¨å¤´è¡Œ: æ·¡è“èƒŒæ™¯ã€åŠ ç²—ã€å±…ä¸­
- âœ… é‡‘é¢æ±‡æ€»åˆ—: å³å¯¹é½ã€è´§å¸æ ¼å¼
- âœ… æ‰€æœ‰å•å…ƒæ ¼: ç»†è¾¹æ¡†
- âœ… å­—ä½“: å¾®è½¯é›…é»‘ 10å·

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### 1. å•å…ƒæ ¼åœ°å€ç¼–ç 

```typescript
// è¡Œåˆ—ç´¢å¼• â†’ å•å…ƒæ ¼åœ°å€
const cellAddress = XLSXStyle.utils.encode_cell({ r: 1, c: 0 })
// ç»“æœ: "A2" (ç¬¬2è¡Œç¬¬1åˆ—)
```

### 2. èŒƒå›´è§£æ

```typescript
// è§£æ sheet çš„èŒƒå›´
const range = XLSXStyle.utils.decode_range(sheet['!ref'])
// range.s.c: èµ·å§‹åˆ—
// range.e.c: ç»“æŸåˆ—
// range.s.r: èµ·å§‹è¡Œ
// range.e.r: ç»“æŸè¡Œ
```

### 3. æ ·å¼å¯¹è±¡ç»“æ„

```typescript
{
  font: {
    name: 'å¾®è½¯é›…é»‘',  // å­—ä½“åç§°
    sz: 10,            // å­—å·
    bold: true,        // åŠ ç²—
    color: { rgb: 'FF0000' }  // é¢œè‰²
  },
  fill: {
    fgColor: { rgb: 'DDEBF7' }  // èƒŒæ™¯è‰²
  },
  alignment: {
    horizontal: 'center',  // æ°´å¹³å¯¹é½
    vertical: 'center'     // å‚ç›´å¯¹é½
  },
  border: {
    top: { style: 'thin', color: { rgb: '000000' } },
    bottom: { style: 'thin', color: { rgb: '000000' } },
    left: { style: 'thin', color: { rgb: '000000' } },
    right: { style: 'thin', color: { rgb: '000000' } }
  },
  numFmt: 'Â¥#,##0.00'  // æ•°å­—æ ¼å¼
}
```

---

## ğŸ¯ æ ·å¼è§„èŒƒæ€»ç»“

| å…ƒç´  | æ ·å¼ |
|------|------|
| **è¡¨å¤´è¡Œ** | å¾®è½¯é›…é»‘ 10å· åŠ ç²—, æ·¡è“èƒŒæ™¯ (#DDEBF7), å±…ä¸­, ç»†è¾¹æ¡† |
| **é‡‘é¢åˆ—** | å³å¯¹é½, è´§å¸æ ¼å¼ (Â¥#,##0.00) |
| **æ—¶é—´åˆ—** | æ—¥æœŸæ—¶é—´æ ¼å¼ (yyyy-mm-dd hh:mm) |
| **å®¡è®¡ç»“æœåˆ—** | ç»¿è‰²(åˆè§„) / æ©™è‰²(ç–‘ä¼¼) / çº¢è‰²(è¿è§„) |
| **è¾¹æ¡†** | æ‰€æœ‰å•å…ƒæ ¼ç»†è¾¹æ¡† |
| **å­—ä½“** | å¾®è½¯é›…é»‘ 10å· |

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. xlsx vs xlsx-js-style

- **xlsx**: ä¸æ”¯æŒæ ·å¼,åªèƒ½å¯¼å‡ºçº¯æ•°æ®
- **xlsx-js-style**: æ”¯æŒå®Œæ•´æ ·å¼,ä½†æ–‡ä»¶ç¨å¤§

### 2. æ€§èƒ½è€ƒè™‘

- æ ·å¼åº”ç”¨ä¼šå¢åŠ å¤„ç†æ—¶é—´
- å¯¹äºå¤§é‡æ•°æ®(>1000è¡Œ),å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ

### 3. å…¼å®¹æ€§

- ç”Ÿæˆçš„ Excel æ–‡ä»¶å…¼å®¹ Excel 2007+ (.xlsx)
- æ”¯æŒ WPSã€LibreOffice ç­‰åŠå…¬è½¯ä»¶

---

**Excel æ ·å¼åŠŸèƒ½å·²å®Œæ•´å®ç°! ğŸ‰**

ç°åœ¨å¯¼å‡ºçš„ Excel æ–‡ä»¶åŒ…å«å®Œæ•´çš„æ ·å¼:
- âœ… è¡¨å¤´æ·¡è“èƒŒæ™¯
- âœ… é‡‘é¢è´§å¸æ ¼å¼
- âœ… æ—¶é—´æ—¥æœŸæ ¼å¼
- âœ… å®¡è®¡ç»“æœé¢œè‰²æ ‡è¯†
- âœ… å…¨éƒ¨ç»†è¾¹æ¡†
- âœ… å¾®è½¯é›…é»‘å­—ä½“

å¼€å§‹æµ‹è¯•å§! ğŸš€

